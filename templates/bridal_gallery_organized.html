{% extends "base.html" %}

{% block style %}
<style>
    :root {
        --primary-purple: #5e35b1;
        --secondary-purple: #7e57c2;
        --dark-purple: #4527a0;
        --light-purple: #b39ddb;
        --dark-surface: #1a1a1a;
        --card-surface: #212121;
        --border-color: #333333;
        --text-primary: #f5f5f5;
        --text-secondary: #bdbdbd;
        --accent-color: var(--light-purple);
    }
    
    body {
        background-color: var(--dark-surface);
        color: var(--text-primary);
        font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    
    .bridal-card {
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        background-color: var(--card-surface);
        border-radius: 10px;
        overflow: hidden;
        height: 100%;
    }
    
    .bridal-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        border-color: var(--accent-color);
    }
    
    .bridal-card.selected {
        border-color: var(--accent-color);
    }
    
    .category-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--primary-purple);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-weight: bold;
        z-index: 10;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .template-type-badge {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 0.7rem;
        z-index: 10;
    }
    
    .btn-floating {
        position: absolute;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        z-index: 10;
    }
    
    .btn-try {
        bottom: 10px;
        right: 10px;
        background-color: var(--secondary-purple);
        color: white;
    }
    
    .btn-try:hover {
        background-color: var(--primary-purple);
        color: white;
    }
    
    .ceremony-section {
        margin-bottom: 40px;
    }
    
    .ceremony-heading {
        padding-bottom: 8px;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--light-purple);
        display: flex;
        align-items: center;
    }
    
    .ceremony-icon {
        width: 32px;
        height: 32px;
        margin-right: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }
    
    .haldi-icon {
        background-color: #ffc107;
        color: #212121;
    }
    
    .mehendi-icon {
        background-color: #4caf50;
        color: white;
    }
    
    .sangeeth-icon {
        background-color: #2196f3;
        color: white;
    }
    
    .wedding-icon {
        background-color: #f44336;
        color: white;
    }
    
    .reception-icon {
        background-color: #9c27b0;
        color: white;
    }
    
    .show-more-btn {
        border: 1px solid var(--accent-color);
        color: var(--accent-color);
        background-color: transparent;
        border-radius: 20px;
        padding: 5px 15px;
        font-size: 0.85rem;
        transition: all 0.3s ease;
    }
    
    .show-more-btn:hover {
        background-color: var(--accent-color);
        color: white;
    }
    
    .template-img-container {
        height: 280px;
        overflow: hidden;
        position: relative;
    }
    
    .template-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .bridal-card:hover .template-img {
        transform: scale(1.05);
    }
    
    .card-body {
        padding: 15px;
    }
    
    .upload-modal-content {
        background-color: var(--card-surface);
        border: 1px solid var(--border-color);
    }
    
    .upload-modal-header, .upload-modal-footer {
        border-color: var(--border-color);
    }
    
    .image-preview-container {
        min-height: 200px;
        border: 2px dashed var(--light-purple);
        border-radius: 5px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Upload Photo Button (top-right) -->
<div class="position-fixed top-0 end-0 p-4" style="z-index: 1050; margin-top: 60px; margin-right: 20px;">
    <button type="button" class="btn btn-primary rounded-circle shadow-lg" data-bs-toggle="modal" data-bs-target="#uploadPhotoModal" style="width: 60px; height: 60px;">
        <i class="fas fa-upload"></i>
    </button>
</div>

<!-- Upload Photo Modal Dialog -->
<div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-labelledby="uploadPhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content upload-modal-content text-white">
            <div class="modal-header upload-modal-header">
                <h5 class="modal-title" id="uploadPhotoModalLabel">Upload Your Photo</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="image-preview-container mb-4 d-flex align-items-center justify-content-center mx-auto" style="width: 200px; height: 200px;">
                    <img id="source-preview" class="img-fluid d-none rounded-circle shadow" style="width: 180px; height: 180px; object-fit: cover;" alt="Your photo preview">
                    <div id="source-placeholder" class="d-flex align-items-center justify-content-center flex-column">
                        <i class="fas fa-user-circle mb-2" style="font-size: 4rem; color: var(--light-purple);"></i>
                        <p class="text-center text-secondary">No photo selected yet</p>
                    </div>
                </div>
                
                <form id="upload-form" enctype="multipart/form-data">
                    <div class="mb-3">
                        <input type="file" class="form-control" id="source-input" name="source" accept=".jpg,.jpeg,.png" required>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary mt-1 d-none" type="button" id="source-clear-btn">
                        <i class="fas fa-times me-1"></i> Remove Photo
                    </button>
                </form>
                
                <div class="alert alert-info mt-3">
                    <small><i class="fas fa-info-circle me-1"></i> Select a clear frontal photo of your face for best results</small>
                </div>
            </div>
            <div class="modal-footer upload-modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmUpload">
                    <i class="fas fa-check me-1"></i> Confirm Photo
                </button>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid py-4">
    <!-- Settings Bar -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body p-2">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="templateType" id="real" value="real" checked autocomplete="off">
                            <label class="btn btn-outline-secondary" for="real">Real Photos</label>
                            
                            <input type="radio" class="btn-check" name="templateType" id="natural" value="natural" autocomplete="off">
                            <label class="btn btn-outline-secondary" for="natural">Natural Style</label>
                            
                            <input type="radio" class="btn-check" name="templateType" id="ai" value="ai" autocomplete="off">
                            <label class="btn btn-outline-secondary" for="ai">AI Generated</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex gap-2 justify-content-md-end mt-3 mt-md-0">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="cat-haldi" value="haldi" checked>
                            <label class="form-check-label" for="cat-haldi">Haldi</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="cat-mehendi" value="mehendi" checked>
                            <label class="form-check-label" for="cat-mehendi">Mehendi</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="cat-sangeeth" value="sangeeth" checked>
                            <label class="form-check-label" for="cat-sangeeth">Sangeeth</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="cat-wedding" value="wedding" checked>
                            <label class="form-check-label" for="cat-wedding">Wedding</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="cat-reception" value="reception" checked>
                            <label class="form-check-label" for="cat-reception">Reception</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ceremony Sections -->
    {% for ceremony_type in ceremony_types %}
    <div class="ceremony-section" id="{{ ceremony_type }}-section">
        <div class="d-flex justify-content-between align-items-center ceremony-heading">
            <div class="d-flex align-items-center">
                <div class="ceremony-icon {{ ceremony_type }}-icon">
                    {% if ceremony_type == 'haldi' %}
                        <i class="fas fa-sun"></i>
                    {% elif ceremony_type == 'mehendi' %}
                        <i class="fas fa-paint-brush"></i>
                    {% elif ceremony_type == 'sangeeth' %}
                        <i class="fas fa-music"></i>
                    {% elif ceremony_type == 'wedding' %}
                        <i class="fas fa-heart"></i>
                    {% elif ceremony_type == 'reception' %}
                        <i class="fas fa-glass-cheers"></i>
                    {% endif %}
                </div>
                <h3 class="mb-0">{{ ceremony_type|title }} Ceremony</h3>
            </div>
            <button class="show-more-btn">
                <i class="fas fa-th me-1"></i> Show More
            </button>
        </div>
        
        <div class="row">
            {% set ceremony = ceremony_type %}
            {% for template_type in template_types %}
                {% if templates[ceremony][template_type] %}
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4 template-card {{ template_type }}-template {{ ceremony }}-ceremony">
                    <div class="bridal-card shadow-sm" data-ceremony="{{ ceremony }}" data-type="{{ template_type }}">
                        <div class="category-badge">{{ ceremony|title }}</div>
                        <div class="template-type-badge">{{ template_type|title }}</div>
                        <div class="template-img-container">
                            <img src="{{ templates[ceremony][template_type] }}" class="template-img" alt="{{ ceremony|title }} {{ template_type|title }} Template">
                            <a href="/bridal-swap?style={{ ceremony }}&template_type={{ template_type }}" class="btn-floating btn-try">
                                <i class="fas fa-magic"></i>
                            </a>
                        </div>
                        <div class="card-body">
                            <h6 class="card-title">{{ ceremony|title }} {{ template_type|title }}</h6>
                            <p class="card-text small">
                                {% if template_type == 'real' %}
                                    Authentic traditional outfit and jewelry
                                {% elif template_type == 'natural' %}
                                    Natural look with traditional elements
                                {% else %}
                                    AI-generated design with artistic style
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Template type filter
    const templateTypeRadios = document.querySelectorAll('input[name="templateType"]');
    templateTypeRadios.forEach(radio => {
        radio.addEventListener('change', filterTemplates);
    });
    
    // Ceremony type filter
    const ceremonyCheckboxes = document.querySelectorAll('input[type="checkbox"]');
    ceremonyCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', filterTemplates);
    });
    
    // Initial filtering
    filterTemplates();
    
    // Photo upload preview
    const sourceInput = document.getElementById('source-input');
    const sourcePreview = document.getElementById('source-preview');
    const sourcePlaceholder = document.getElementById('source-placeholder');
    const sourceClearBtn = document.getElementById('source-clear-btn');
    
    sourceInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            let reader = new FileReader();
            reader.onload = function(e) {
                sourcePreview.src = e.target.result;
                sourcePreview.classList.remove('d-none');
                sourcePlaceholder.classList.add('d-none');
                sourceClearBtn.classList.remove('d-none');
            }
            reader.readAsDataURL(this.files[0]);
        }
    });
    
    sourceClearBtn.addEventListener('click', function() {
        sourceInput.value = '';
        sourcePreview.classList.add('d-none');
        sourcePlaceholder.classList.remove('d-none');
        sourceClearBtn.classList.add('d-none');
    });
    
    // Show more button
    const showMoreBtns = document.querySelectorAll('.show-more-btn');
    showMoreBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const section = this.closest('.ceremony-section');
            const ceremonyType = section.id.split('-')[0];
            window.location.href = `/bridal-swap?style=${ceremonyType}`;
        });
    });
});

function filterTemplates() {
    // Get selected template type
    const selectedType = document.querySelector('input[name="templateType"]:checked').value;
    
    // Get selected ceremonies
    const selectedCeremonies = [];
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
        selectedCeremonies.push(checkbox.value);
    });
    
    // Filter template cards
    const templateCards = document.querySelectorAll('.template-card');
    templateCards.forEach(card => {
        const cardType = card.classList.contains(`${selectedType}-template`);
        const cardCeremony = selectedCeremonies.some(ceremony => 
            card.classList.contains(`${ceremony}-ceremony`)
        );
        
        if (cardType && cardCeremony) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
    
    // Hide ceremony sections with no visible cards
    document.querySelectorAll('.ceremony-section').forEach(section => {
        const ceremonyType = section.id.split('-')[0];
        const hasVisibleCards = selectedCeremonies.includes(ceremonyType) && 
            section.querySelector(`.${selectedType}-template`);
        
        if (hasVisibleCards) {
            section.style.display = 'block';
        } else {
            section.style.display = 'none';
        }
    });
}
</script>
{% endblock %}