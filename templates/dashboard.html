{% extends "base.html" %}

{% block style %}
<style>
    .stats-card {
        background-color: var(--card-surface);
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        padding: 20px;
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .stats-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
    }
    
    .stats-value {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 0;
    }
    
    .stats-label {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 0;
    }
    
    .timeline {
        position: relative;
        padding-left: 50px;
    }
    
    .timeline:before {
        content: '';
        position: absolute;
        top: 0;
        left: 15px;
        height: 100%;
        width: 2px;
        background-color: var(--border-color);
    }
    
    .timeline-item {
        position: relative;
        margin-bottom: 30px;
    }
    
    .timeline-item:last-child {
        margin-bottom: 0;
    }
    
    .timeline-item:before {
        content: '';
        position: absolute;
        top: 0;
        left: -50px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: var(--primary-purple);
        border: 4px solid var(--card-surface);
    }
    
    .event-card {
        background-color: var(--card-surface);
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .event-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background-color: rgba(0,0,0,0.2);
        border-bottom: 1px solid var(--border-color);
    }
    
    .event-date {
        font-size: 14px;
        color: var(--text-secondary);
    }
    
    .event-type {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
    }
    
    .event-type.haldi {
        background-color: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }
    
    .event-type.mehendi {
        background-color: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
    
    .event-type.sangeeth {
        background-color: rgba(23, 162, 184, 0.2);
        color: #17a2b8;
    }
    
    .event-type.wedding {
        background-color: rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }
    
    .event-type.reception {
        background-color: rgba(111, 66, 193, 0.2);
        color: #7e57c2;
    }
    
    .event-body {
        padding: 20px;
    }
    
    .event-title {
        margin-bottom: 10px;
    }
    
    .event-venue {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        color: var(--text-secondary);
    }
    
    .task-card {
        background-color: var(--card-surface);
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 15px;
        padding: 15px;
        transition: all 0.3s ease;
    }
    
    .task-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }
    
    .task-card.high-priority {
        border-left: 4px solid #dc3545;
    }
    
    .task-card.medium-priority {
        border-left: 4px solid #ffc107;
    }
    
    .task-card.low-priority {
        border-left: 4px solid #28a745;
    }
    
    .task-title {
        margin-bottom: 5px;
        font-size: 16px;
        font-weight: 600;
    }
    
    .task-due-date {
        font-size: 12px;
        color: var(--text-secondary);
    }
    
    .task-status {
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .task-status.pending {
        background-color: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }
    
    .task-status.in-progress {
        background-color: rgba(0, 123, 255, 0.2);
        color: #0d6efd;
    }
    
    .task-status.completed {
        background-color: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-0">Dashboard</h1>
            <p class="text-muted">Welcome back, {{ current_user.first_name }}!</p>
        </div>
    </div>
    
    <!-- Statistics Cards -->
    <div class="row mb-5">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card">
                <div class="stats-icon bg-primary">
                    <i class="fas fa-calendar-alt text-white"></i>
                </div>
                <p class="stats-value">{{ events|length }}</p>
                <p class="stats-label">Total Events</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card">
                <div class="stats-icon bg-success">
                    <i class="fas fa-check-circle text-white"></i>
                </div>
                <p class="stats-value">{{ tasks|selectattr('status', 'equalto', 'completed')|list|length }}</p>
                <p class="stats-label">Completed Tasks</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card">
                <div class="stats-icon bg-warning">
                    <i class="fas fa-tasks text-white"></i>
                </div>
                <p class="stats-value">{{ tasks|selectattr('status', 'equalto', 'pending')|list|length }}</p>
                <p class="stats-label">Pending Tasks</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card">
                <div class="stats-icon bg-info">
                    <i class="fas fa-images text-white"></i>
                </div>
                <p class="stats-value">{{ current_user.generated_images|length }}</p>
                <p class="stats-label">Generated Images</p>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Upcoming Events -->
        <div class="col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header bg-dark d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="fas fa-calendar-day me-2"></i>Upcoming Events</h4>
                    <a href="{{ url_for('list_events') }}" class="btn btn-sm btn-outline-light">
                        <i class="fas fa-plus me-1"></i>Add Event
                    </a>
                </div>
                <div class="card-body">
                    {% if events %}
                        {% for event in events|sort(attribute='event_date') %}
                            {% if event.event_date > now %}
                                <div class="event-card">
                                    <div class="event-header">
                                        <span class="event-date">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            {{ event.event_date.strftime('%b %d, %Y') }}
                                        </span>
                                        <span class="event-type {{ event.ceremony_type }}">{{ event.ceremony_type }}</span>
                                    </div>
                                    <div class="event-body">
                                        <h5 class="event-title">{{ event.title }}</h5>
                                        <div class="event-venue">
                                            <i class="fas fa-map-marker-alt me-2"></i>
                                            {{ event.venue }}
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="text-muted small">
                                                <i class="fas fa-clock me-1"></i>
                                                {{ (event.event_date - now).days }} days left
                                            </span>
                                            <a href="{{ url_for('view_event', event_id=event.id) }}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>View Details
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                        {% if events|selectattr('event_date', 'gt', now)|list|length == 0 %}
                            <div class="text-center py-5">
                                <i class="fas fa-calendar-check text-muted fa-3x mb-3"></i>
                                <p>No upcoming events scheduled.</p>
                                <a href="{{ url_for('create_event') }}" class="btn btn-primary">
                                    <i class="fas fa-plus me-1"></i>Schedule Event
                                </a>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-calendar text-muted fa-3x mb-3"></i>
                            <p>No events added yet.</p>
                            <a href="{{ url_for('create_event') }}" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i>Add First Event
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Tasks -->
        <div class="col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header bg-dark d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="fas fa-tasks me-2"></i>To-Do List</h4>
                    <button class="btn btn-sm btn-outline-light">
                        <i class="fas fa-plus me-1"></i>Add Task
                    </button>
                </div>
                <div class="card-body">
                    {% if tasks %}
                        <div class="d-flex justify-content-end mb-3">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-secondary active" data-filter="all">All</button>
                                <button class="btn btn-outline-secondary" data-filter="pending">Pending</button>
                                <button class="btn btn-outline-secondary" data-filter="in_progress">In Progress</button>
                                <button class="btn btn-outline-secondary" data-filter="completed">Completed</button>
                            </div>
                        </div>
                        
                        {% for task in tasks|sort(attribute='due_date') %}
                            <div class="task-card {{ task.priority }}-priority" data-status="{{ task.status }}">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="task-title">{{ task.title }}</h5>
                                        <p class="task-due-date">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            Due: {{ task.due_date.strftime('%b %d, %Y') }}
                                        </p>
                                    </div>
                                    <span class="task-status {{ task.status }}">{{ task.status }}</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <span class="text-muted small">
                                        <i class="fas fa-tag me-1"></i>
                                        {{ task.priority }} priority
                                    </span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success btn-sm">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-check-circle text-muted fa-3x mb-3"></i>
                            <p>No tasks created yet.</p>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i>Create First Task
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Timeline -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-dark">
                    <h4 class="mb-0"><i class="fas fa-history me-2"></i>Wedding Timeline</h4>
                </div>
                <div class="card-body">
                    {% if events %}
                        <div class="timeline">
                            {% for event in events|sort(attribute='event_date') %}
                                <div class="timeline-item">
                                    <div class="d-flex align-items-center mb-2">
                                        <h5 class="mb-0 me-2">{{ event.title }}</h5>
                                        <span class="event-type {{ event.ceremony_type }}">{{ event.ceremony_type }}</span>
                                    </div>
                                    <p class="mb-1">
                                        <i class="fas fa-calendar-alt me-1"></i>
                                        {{ event.event_date.strftime('%B %d, %Y') }}
                                    </p>
                                    <p class="mb-1">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        {{ event.venue }}
                                    </p>
                                    <p class="mb-0">{{ event.description|truncate(100) }}</p>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-calendar-alt text-muted fa-3x mb-3"></i>
                            <p>Add events to see your wedding timeline</p>
                            <a href="{{ url_for('create_event') }}" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i>Add Event
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Task filtering
        const filterButtons = document.querySelectorAll('[data-filter]');
        const taskCards = document.querySelectorAll('.task-card');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                const filter = this.getAttribute('data-filter');
                
                taskCards.forEach(card => {
                    if (filter === 'all' || card.getAttribute('data-status') === filter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    });
</script>
{% endblock %}