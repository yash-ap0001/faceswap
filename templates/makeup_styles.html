{% extends "base.html" %}

{% block title %}Makeup Styles | VowBride{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 class="text-center mb-0">Bridal Makeup Styles</h1>
            <p class="text-center text-muted mb-4">Find the perfect makeup look for your wedding day</p>
        </div>
    </div>

    <!-- Category filter checkboxes -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="category-filters d-flex justify-content-center flex-wrap gap-2">
                {% for category_id, category in categories.items() %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="cat-{{ category_id }}" value="{{ category_id }}" checked>
                    <label class="form-check-label" for="cat-{{ category_id }}">{{ category.name }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Templates by category -->
    {% for category_id, category in categories.items() %}
    <div id="{{ category_id }}-carousel" class="template-container position-relative mb-4">
        <h3 class="section-title ps-3 mb-3">{{ category.name }}</h3>
        <div class="row px-1" id="{{ category_id }}-cards">
            {% if category.templates|length > 0 %}
                {% for template in category.templates %}
                <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-3 template-card"
                     data-style="{{ category_id }}">
                    <div class="card h-100 border-0 shadow-sm position-relative template-item">
                        <img src="{{ template.url }}" class="card-img-top template-image rounded" 
                             alt="{{ category.name }}" loading="lazy"
                             data-full-img="{{ template.url }}">
                        <div class="overlay d-flex justify-content-center align-items-center">
                            <button class="btn btn-sm btn-outline-light view-image-btn me-1"
                                    data-template-path="{{ template.path }}">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="col-12 text-center py-5">
                    <div class="empty-state">
                        <i class="fas fa-palette fa-3x mb-3 text-muted"></i>
                        <h5>No Templates Available</h5>
                        <p class="text-muted">Bridal makeup templates for {{ category.name }} will be coming soon!</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Image Preview Modal -->
<div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-labelledby="imagePreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-body p-0 position-relative">
                <button type="button" class="btn-close position-absolute top-0 end-0 m-2 bg-white" data-bs-dismiss="modal" aria-label="Close"></button>
                <img src="" id="previewImage" class="img-fluid rounded w-100" alt="Preview">
                <div class="zoom-controls position-absolute bottom-0 end-0 m-2">
                    <button class="btn btn-sm btn-light zoom-in me-1"><i class="fas fa-search-plus"></i></button>
                    <button class="btn btn-sm btn-light zoom-out me-1"><i class="fas fa-search-minus"></i></button>
                    <button class="btn btn-sm btn-light zoom-reset"><i class="fas fa-sync"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    try {
        // Initialize image preview modal
        const imagePreviewModal = new bootstrap.Modal(document.getElementById('imagePreviewModal'));
        const previewImage = document.getElementById('previewImage');
        
        // Setup view image buttons
        document.querySelectorAll('.view-image-btn').forEach(button => {
            button.addEventListener('click', function() {
                const templateUrl = this.closest('.template-item').querySelector('.template-image').getAttribute('data-full-img');
                previewImage.src = templateUrl;
                imagePreviewModal.show();
            });
        });
        
        // Setup zoom controls
        const zoomIn = document.querySelector('.zoom-in');
        const zoomOut = document.querySelector('.zoom-out');
        const zoomReset = document.querySelector('.zoom-reset');
        let scale = 1;
        
        zoomIn.addEventListener('click', function() {
            scale += 0.1;
            previewImage.style.transform = `scale(${scale})`;
        });
        
        zoomOut.addEventListener('click', function() {
            if (scale > 0.5) {
                scale -= 0.1;
                previewImage.style.transform = `scale(${scale})`;
            }
        });
        
        zoomReset.addEventListener('click', function() {
            scale = 1;
            previewImage.style.transform = 'scale(1)';
        });
        
        // Setup category filter checkboxes
        function updateCategoryVisibility() {
            try {
                // Get all the checked category checkboxes
                const checkedCategories = Array.from(document.querySelectorAll('input[id^="cat-"]:checked'))
                                        .map(checkbox => checkbox.value);
                
                console.log('Checked categories:', checkedCategories);
                
                // Hide/show category sections
                document.querySelectorAll('div[id$="-carousel"]').forEach(section => {
                    if (!section.id) return;
                    
                    // Extract category name from section ID (like 'traditional-carousel' â†’ 'traditional')
                    const categoryId = section.id.replace('-carousel', '');
                    
                    if (checkedCategories.includes(categoryId)) {
                        section.style.display = 'block';
                    } else {
                        section.style.display = 'none';
                    }
                });
            } catch (error) {
                console.error('Error in updateCategoryVisibility:', error);
            }
        }
        
        // Add event listeners to category checkboxes
        const categoryCheckboxes = document.querySelectorAll('input[id^="cat-"]');
        categoryCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateCategoryVisibility);
        });
        
        // Initialize visibility based on checked boxes
        updateCategoryVisibility();
    } catch (error) {
        console.error("Error initializing makeup styles page:", error);
    }
});
</script>
{% endblock %}