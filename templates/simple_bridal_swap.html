{% extends "base.html" %}

{% block title %}Simple Bridal Swap{% endblock %}

{% block head %}
{{ super() }}
<style>
    .bridal-header {
        text-align: center;
        margin-bottom: 30px;
        background: linear-gradient(90deg, #8e2de2, #4a00e0);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .template-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 15px;
    }
    
    .template-card {
        cursor: pointer;
        transition: all 0.2s;
        border: 3px solid transparent;
        overflow: hidden;
        border-radius: 8px;
    }
    
    .template-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .template-card.selected {
        border-color: #8e44ad !important;
        box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.5);
    }
    
    .template-img {
        width: 100%;
        height: 230px;
        object-fit: cover;
        border-radius: 5px;
    }
    
    #unified-template-area {
        position: fixed;
        top: 10%;
        left: 10%;
        right: 10%;
        bottom: 10%;
        z-index: 1050;
        background: #212529;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
    }
    
    .multi-results-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 15px;
    }
    
    .multi-result-card {
        width: 280px;
        flex-grow: 0;
        flex-shrink: 0;
        border-radius: 8px;
        overflow: hidden;
        background: #343a40;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .multi-result-img {
        width: 100%;
        height: 230px;
        object-fit: cover;
    }
    
    .tab-content {
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .selected-templates-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 15px;
    }
    
    .selected-template-card {
        width: 150px;
        position: relative;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .selected-template-img {
        width: 100%;
        height: 180px;
        object-fit: cover;
    }
    
    .remove-template-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(0, 0, 0, 0.5);
        border: none;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Bridal Header -->
    <div class="bridal-header">
        <h1 class="text-white mb-0">Indian Bridal Face Swap</h1>
    </div>
    
    <div class="row">
        <!-- Left Column -->
        <div class="col-md-6">
            <!-- Upload Section -->
            <div class="card bg-dark shadow-lg border-0 mb-4">
                <div class="card-header bg-primary bg-gradient">
                    <h4 class="mb-0 text-white"><i class="fas fa-upload me-2"></i>Upload Your Photo</h4>
                </div>
                <div class="card-body">
                    <form id="upload-form" enctype="multipart/form-data">
                        <div class="mb-3">
                            <input class="form-control form-control-lg" type="file" id="file-input" accept="image/*">
                            <div class="form-text">Upload a photo with your face clearly visible.</div>
                        </div>
                    </form>
                    
                    <div id="uploaded-image-container" class="text-center my-3 d-none">
                        <img id="uploaded-image" class="img-fluid rounded shadow-sm" style="max-height: 200px;" alt="Your uploaded photo">
                    </div>
                    
                    <!-- Ceremony Type & Action Buttons -->
                    <div id="action-buttons" class="d-none">
                        <div class="mb-3">
                            <label for="ceremony-select" class="form-label">Ceremony Type</label>
                            <select id="ceremony-select" class="form-select form-select-lg">
                                <option value="haldi">Haldi Ceremony</option>
                                <option value="mehendi">Mehendi Ceremony</option>
                                <option value="wedding">Wedding Ceremony</option>
                                <option value="reception">Reception</option>
                            </select>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex mt-3">
                            <button id="quick-create-btn" type="button" class="btn btn-primary flex-fill">
                                <i class="fas fa-bolt me-1"></i> Quick Create
                            </button>
                            <button id="browse-templates-btn" type="button" class="btn btn-outline-light flex-fill">
                                <i class="fas fa-images me-1"></i> Browse Templates
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Column -->
        <div class="col-md-6">
            <!-- Selected Templates Display -->
            <div id="selected-templates-area" class="card bg-dark shadow-lg border-0 mb-4 d-none">
                <div class="card-header bg-primary bg-gradient">
                    <h4 class="mb-0 text-white"><i class="fas fa-check-circle me-2"></i>Selected Templates</h4>
                </div>
                <div class="card-body">
                    <div id="selected-templates-container" class="selected-templates-container"></div>
                    
                    <div class="d-grid mt-3">
                        <button id="process-selected-btn" type="button" class="btn btn-success">
                            <i class="fas fa-magic me-1"></i> Create My Bridal Look
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- UNIFIED TEMPLATE AREA - Used for both single and multi-select modes -->
    <div id="unified-template-area" class="d-none">
        <div class="card bg-dark border-0 h-100">
            <div class="card-header bg-primary bg-gradient">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-white"><i class="fas fa-images me-2"></i><span id="template-area-title">Choose a Template</span></h4>
                    <div>
                        <div class="form-check form-switch d-inline-block me-3">
                            <input class="form-check-input" type="checkbox" id="multi-select-toggle">
                            <label class="form-check-label text-white" for="multi-select-toggle">Select Multiple</label>
                        </div>
                        <button id="close-template-area-btn" class="btn btn-sm btn-outline-light">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <!-- Template Navigation Tabs -->
                <div class="p-3">
                    <ul class="nav nav-pills" id="template-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="haldi-tab" data-bs-toggle="pill" data-bs-target="#haldi-panel" 
                                    type="button" role="tab" aria-controls="haldi-panel" aria-selected="true">
                                Haldi
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="mehendi-tab" data-bs-toggle="pill" data-bs-target="#mehendi-panel" 
                                    type="button" role="tab" aria-controls="mehendi-panel" aria-selected="false">
                                Mehendi
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="wedding-tab" data-bs-toggle="pill" data-bs-target="#wedding-panel" 
                                    type="button" role="tab" aria-controls="wedding-panel" aria-selected="false">
                                Wedding
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reception-tab" data-bs-toggle="pill" data-bs-target="#reception-panel" 
                                    type="button" role="tab" aria-controls="reception-panel" aria-selected="false">
                                Reception
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- Template Galleries -->
                <div class="tab-content border-top border-secondary p-3" id="template-tabContent">
                    <div class="tab-pane fade show active" id="haldi-panel" role="tabpanel" aria-labelledby="haldi-tab">
                        <div class="template-loading text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading Haldi templates...</p>
                        </div>
                        <div class="template-grid"></div>
                    </div>
                    <div class="tab-pane fade" id="mehendi-panel" role="tabpanel" aria-labelledby="mehendi-tab">
                        <div class="template-loading text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading Mehendi templates...</p>
                        </div>
                        <div class="template-grid"></div>
                    </div>
                    <div class="tab-pane fade" id="wedding-panel" role="tabpanel" aria-labelledby="wedding-tab">
                        <div class="template-loading text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading Wedding templates...</p>
                        </div>
                        <div class="template-grid"></div>
                    </div>
                    <div class="tab-pane fade" id="reception-panel" role="tabpanel" aria-labelledby="reception-tab">
                        <div class="template-loading text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading Reception templates...</p>
                        </div>
                        <div class="template-grid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Indicator -->
    <div id="loading-container" class="text-center my-5 d-none">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h4 class="mt-3 text-light">Creating your bridal look...</h4>
        <p class="text-muted">This may take a moment as we apply AI face swapping.</p>
    </div>
    
    <!-- Error Message -->
    <div id="error-container" class="alert alert-danger border-0 shadow-sm my-4 d-none" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span id="error-message">An error occurred. Please try again.</span>
    </div>
    
    <!-- UNIFIED RESULTS SECTION - For both single and multiple results -->
    <div id="unified-results-section" class="my-4 d-none">
        <div class="card bg-dark shadow-lg border-0">
            <div class="card-header bg-primary bg-gradient text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-crown me-2"></i><span id="results-title">Your Bridal Look</span></h3>
                    <button id="back-to-templates-btn" class="btn btn-sm btn-outline-light">
                        <i class="fas fa-arrow-left me-1"></i>Back
                    </button>
                </div>
            </div>
            <div class="card-body bg-dark">
                <!-- Source Image (always shown once) -->
                <div class="source-image-container text-center mb-4 pb-3 border-bottom border-secondary">
                    <h5 class="mb-3"><i class="fas fa-user me-2"></i>Your Photo</h5>
                    <img id="source-display-image" class="img-fluid rounded shadow-sm" style="max-height: 200px;" alt="Your uploaded photo">
                </div>
                
                <!-- Results Container -->
                <div id="results-container" class="multi-results-container"></div>
                
                <!-- Add More Templates Button -->
                <div class="text-center mt-4">
                    <button id="add-more-templates-btn" class="btn btn-outline-light d-none">
                        <i class="fas fa-plus me-1"></i> Add More Templates
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Model Status Alert -->
    <div id="model-status-alert" class="alert alert-warning my-3 d-none" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span id="model-status-message"></span>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const fileInput = document.getElementById('file-input');
    const uploadedImage = document.getElementById('uploaded-image');
    const uploadedImageContainer = document.getElementById('uploaded-image-container');
    const actionButtons = document.getElementById('action-buttons');
    const sourceDisplayImage = document.getElementById('source-display-image');
    const ceremonySelect = document.getElementById('ceremony-select');
    const quickCreateBtn = document.getElementById('quick-create-btn');
    const browseTemplatesBtn = document.getElementById('browse-templates-btn');
    const unifiedTemplateArea = document.getElementById('unified-template-area');
    const templateAreaTitle = document.getElementById('template-area-title');
    const closeTemplateAreaBtn = document.getElementById('close-template-area-btn');
    const multiSelectToggle = document.getElementById('multi-select-toggle');
    const loadingContainer = document.getElementById('loading-container');
    const errorContainer = document.getElementById('error-container');
    const errorMessage = document.getElementById('error-message');
    const unifiedResultsSection = document.getElementById('unified-results-section');
    const resultsContainer = document.getElementById('results-container');
    const resultsTitle = document.getElementById('results-title');
    const backToTemplatesBtn = document.getElementById('back-to-templates-btn');
    const addMoreTemplatesBtn = document.getElementById('add-more-templates-btn');
    const selectedTemplatesArea = document.getElementById('selected-templates-area');
    const selectedTemplatesContainer = document.getElementById('selected-templates-container');
    const processSelectedBtn = document.getElementById('process-selected-btn');
    
    // State Variables
    let userImage = null;
    let currentCeremony = ceremonySelect.value;
    let selectedTemplates = [];
    let isMultiSelectMode = false;
    
    // File input change
    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImage.src = e.target.result;
                sourceDisplayImage.src = e.target.result;
                uploadedImageContainer.classList.remove('d-none');
                actionButtons.classList.remove('d-none');
                userImage = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Ceremony select change
    ceremonySelect.addEventListener('change', function() {
        currentCeremony = this.value;
        
        // If template area is visible, activate the corresponding tab
        if (!unifiedTemplateArea.classList.contains('d-none')) {
            document.querySelector(`#template-tabs .nav-link[id="${currentCeremony}-tab"]`).click();
        }
    });
    
    // Quick Create button
    quickCreateBtn.addEventListener('click', function() {
        if (!fileInput.files[0]) {
            showError('Please upload your photo first.');
            return;
        }
        
        isMultiSelectMode = false;
        processSingleTemplate();
    });
    
    // Browse Templates button
    browseTemplatesBtn.addEventListener('click', function() {
        if (!fileInput.files[0]) {
            showError('Please upload your photo first.');
            return;
        }
        
        // Show template area
        unifiedTemplateArea.classList.remove('d-none');
        
        // Set title based on multi-select mode
        updateTemplateAreaTitle();
        
        // Load templates for current ceremony
        loadTemplates(currentCeremony);
        
        // Activate relevant tab
        document.querySelector(`#template-tabs .nav-link[id="${currentCeremony}-tab"]`).click();
    });
    
    // Multi-select toggle
    multiSelectToggle.addEventListener('change', function() {
        isMultiSelectMode = this.checked;
        updateTemplateAreaTitle();
    });
    
    // Close template area button
    closeTemplateAreaBtn.addEventListener('click', function() {
        unifiedTemplateArea.classList.add('d-none');
    });
    
    // Process selected button
    processSelectedBtn.addEventListener('click', function() {
        if (selectedTemplates.length === 0) {
            showError('Please select at least one template.');
            return;
        }
        
        processMultiTemplates();
    });
    
    // Back to templates button
    backToTemplatesBtn.addEventListener('click', function() {
        unifiedResultsSection.classList.add('d-none');
        selectedTemplatesArea.classList.remove('d-none');
    });
    
    // Add more templates button
    addMoreTemplatesBtn.addEventListener('click', function() {
        unifiedResultsSection.classList.add('d-none');
        unifiedTemplateArea.classList.remove('d-none');
    });
    
    // Template tab clicks
    document.querySelectorAll('#template-tabs .nav-link').forEach(tab => {
        tab.addEventListener('click', function() {
            const ceremonyType = this.id.replace('-tab', '');
            loadTemplates(ceremonyType);
        });
    });
    
    // Function to load templates
    function loadTemplates(ceremonyType) {
        const templateGrid = document.querySelector(`#${ceremonyType}-panel .template-grid`);
        const loadingIndicator = document.querySelector(`#${ceremonyType}-panel .template-loading`);
        
        // Show loading
        templateGrid.innerHTML = '';
        loadingIndicator.classList.remove('d-none');
        
        // Fetch templates
        fetch(`/get_templates?ceremony=${ceremonyType}&cache=${Date.now()}`)
            .then(response => response.json())
            .then(data => {
                loadingIndicator.classList.add('d-none');
                
                if (data.templates && data.templates.length > 0) {
                    data.templates.forEach((template, index) => {
                        const templateCard = document.createElement('div');
                        templateCard.className = 'template-card';
                        templateCard.dataset.path = template.path;
                        templateCard.dataset.ceremony = ceremonyType;
                        
                        // Check if already selected
                        if (selectedTemplates.some(t => t.path === template.path)) {
                            templateCard.classList.add('selected');
                        }
                        
                        templateCard.innerHTML = `
                            <img src="${template.url}" class="template-img" alt="${ceremonyType} template">
                        `;
                        
                        templateCard.addEventListener('click', function() {
                            const path = this.dataset.path;
                            const ceremony = this.dataset.ceremony;
                            const imgSrc = this.querySelector('img').src;
                            
                            if (isMultiSelectMode) {
                                // Toggle selection in multi-select mode
                                this.classList.toggle('selected');
                                
                                if (this.classList.contains('selected')) {
                                    // Add to selection
                                    selectedTemplates.push({
                                        path: path,
                                        ceremony: ceremony,
                                        url: imgSrc
                                    });
                                } else {
                                    // Remove from selection
                                    selectedTemplates = selectedTemplates.filter(t => t.path !== path);
                                }
                            } else {
                                // Single template mode - select one template
                                // Clear all selected templates
                                document.querySelectorAll('.template-card.selected').forEach(card => {
                                    card.classList.remove('selected');
                                });
                                
                                // Select this template
                                this.classList.add('selected');
                                selectedTemplates = [{
                                    path: path,
                                    ceremony: ceremony,
                                    url: imgSrc
                                }];
                                
                                // Hide template area
                                unifiedTemplateArea.classList.add('d-none');
                            }
                            
                            // Update selected templates display
                            updateSelectedTemplatesDisplay();
                        });
                        
                        templateGrid.appendChild(templateCard);
                    });
                } else {
                    templateGrid.innerHTML = '<div class="alert alert-info">No templates found for this ceremony type.</div>';
                }
            })
            .catch(error => {
                console.error('Error fetching templates:', error);
                loadingIndicator.classList.add('d-none');
                templateGrid.innerHTML = '<div class="alert alert-danger">Failed to load templates. Please try again.</div>';
            });
    }
    
    // Update selected templates display
    function updateSelectedTemplatesDisplay() {
        if (selectedTemplates.length > 0) {
            selectedTemplatesContainer.innerHTML = '';
            
            selectedTemplates.forEach((template, index) => {
                const templateCard = document.createElement('div');
                templateCard.className = 'selected-template-card';
                templateCard.innerHTML = `
                    <img src="${template.url}" class="selected-template-img" alt="${template.ceremony} template">
                    <button type="button" class="remove-template-btn" data-index="${index}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // Add remove button click event
                templateCard.querySelector('.remove-template-btn').addEventListener('click', function() {
                    const idx = parseInt(this.dataset.index);
                    const removedTemplate = selectedTemplates[idx];
                    
                    // Remove from selected templates array
                    selectedTemplates.splice(idx, 1);
                    
                    // Update the display
                    updateSelectedTemplatesDisplay();
                    
                    // Remove 'selected' class from template card if visible
                    document.querySelectorAll('.template-card').forEach(card => {
                        if (card.dataset.path === removedTemplate.path) {
                            card.classList.remove('selected');
                        }
                    });
                });
                
                selectedTemplatesContainer.appendChild(templateCard);
            });
            
            // Show selected templates area
            selectedTemplatesArea.classList.remove('d-none');
        } else {
            // Hide selected templates area if no templates are selected
            selectedTemplatesArea.classList.add('d-none');
        }
    }
    
    // Process single template
    function processSingleTemplate() {
        // Show loading
        loadingContainer.classList.remove('d-none');
        
        // Prepare form data
        const formData = new FormData();
        formData.append('source', fileInput.files[0]);
        formData.append('ceremony', currentCeremony);
        
        // Send request
        fetch('/bridal-swap', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            loadingContainer.classList.add('d-none');
            
            if (data.success) {
                // Show results
                unifiedResultsSection.classList.remove('d-none');
                resultsTitle.textContent = 'Your ' + currentCeremony.charAt(0).toUpperCase() + currentCeremony.slice(1) + ' Look';
                
                // Clear previous results
                resultsContainer.innerHTML = '';
                
                // Add single result
                const resultCard = document.createElement('div');
                resultCard.className = 'multi-result-card';
                resultCard.innerHTML = `
                    <img src="${data.result_image}" class="multi-result-img" alt="Result">
                    <div class="card-body text-center">
                        <a href="${data.result_image}" class="btn btn-sm btn-success" download>
                            <i class="fas fa-download"></i> Save
                        </a>
                    </div>
                `;
                
                resultsContainer.appendChild(resultCard);
            } else {
                showError(data.error || 'Failed to process the image. Please try again.');
            }
        })
        .catch(error => {
            loadingContainer.classList.add('d-none');
            showError('Error: ' + error.message);
            console.error('Error:', error);
        });
    }
    
    // Process multiple templates
    function processMultiTemplates() {
        // Show loading
        loadingContainer.classList.remove('d-none');
        
        // Hide selected templates area
        selectedTemplatesArea.classList.add('d-none');
        
        // Prepare form data
        const formData = new FormData();
        formData.append('source', fileInput.files[0]);
        formData.append('template_count', selectedTemplates.length);
        
        // Add templates
        selectedTemplates.forEach((template, index) => {
            formData.append(`template_${index}`, template.path);
            formData.append(`ceremony_${index}`, template.ceremony);
        });
        
        // Send request
        fetch('/bridal-swap-multi', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            loadingContainer.classList.add('d-none');
            
            if (data.success) {
                // Show results
                unifiedResultsSection.classList.remove('d-none');
                resultsTitle.textContent = 'Your Bridal Looks';
                
                // Clear previous results
                resultsContainer.innerHTML = '';
                
                // Add results
                data.results.forEach(result => {
                    const resultCard = document.createElement('div');
                    resultCard.className = 'multi-result-card';
                    resultCard.innerHTML = `
                        <img src="${result.result_image}" class="multi-result-img" alt="Result">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2 text-muted">${result.ceremony.charAt(0).toUpperCase() + result.ceremony.slice(1)}</h6>
                            <a href="${result.result_image}" class="btn btn-sm btn-success" download>
                                <i class="fas fa-download"></i> Save
                            </a>
                        </div>
                    `;
                    
                    resultsContainer.appendChild(resultCard);
                });
                
                // Update add more button visibility
                addMoreTemplatesBtn.classList.remove('d-none');
            } else {
                showError(data.error || 'Failed to process the images. Please try again.');
            }
        })
        .catch(error => {
            loadingContainer.classList.add('d-none');
            showError('Error: ' + error.message);
            console.error('Error:', error);
        });
    }
    
    // Show error
    function showError(message) {
        errorContainer.classList.remove('d-none');
        errorMessage.textContent = message;
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            errorContainer.classList.add('d-none');
        }, 5000);
    }
    
    // Update template area title based on mode
    function updateTemplateAreaTitle() {
        templateAreaTitle.textContent = isMultiSelectMode ? 'Select Multiple Templates' : 'Choose a Template';
    }
    
    // Check model status on page load
    fetch('/check_models')
        .then(response => response.json())
        .then(data => {
            if (!data.face_detection_model || !data.face_swap_model) {
                const modelStatusAlert = document.getElementById('model-status-alert');
                const modelStatusMessage = document.getElementById('model-status-message');
                
                modelStatusMessage.textContent = 'Some required models are not loaded. Face swap functionality may be limited.';
                modelStatusAlert.classList.remove('d-none');
            }
        })
        .catch(error => {
            console.error('Error checking model status:', error);
        });
});
</script>
{% endblock %}